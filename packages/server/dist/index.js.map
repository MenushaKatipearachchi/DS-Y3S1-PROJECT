{
  "version": 3,
  "sources": ["../src/index.js"],
  "sourcesContent": ["import fs from \"fs\";\nimport crypto from \"crypto\";\nimport express from \"express\";\nimport expressHealth from \"express-health-middleware\";\nimport compression from \"compression\";\nimport helmet from \"helmet\";\nimport cors from \"cors\";\nimport context from \"express-http-context\";\nimport stack from \"callsite\";\nimport { moduleLogger } from \"@sliit-foss/module-logger\";\nimport { correlationId } from \"@app/constants\";\nimport { errorHandler, responseInterceptor } from \"@app/middleware\";\nimport { connect as connectDatabase } from \"@app/mongoose\";\n\nconst initialize = ({\n  service,\n  routes,\n  lMiddleware = [],\n  cors: isCorsEnable,\n  database,\n  config,\n}) => {\n  const logger = moduleLogger(\"Server\");\n\n  const app = express();\n\n  app.use(helmet());\n  app.use(compression());\n\n  app.use(express.json({ limit: \"1mb\" }));\n  app.use(express.urlencoded({ extended: true }));\n\n  if (isCorsEnable) {\n    app.use(cors());\n  }\n\n  app.use(context.middleware);\n\n  app.use((req, _res, next) => {\n    _res.header(\"Access-Control-Allow-Origin\", \"*\"); // allow front end to access the api\n    _res.header(\n      \"Access-Control-Allow-Headers\",\n      \"Origin, X-Requested-With, Content-Type, Accept\"\n    );\n    context.set(\n      \"correlationId\",\n      req.headers[correlationId] ?? crypto.randomBytes(16).toString(\"hex\")\n    );\n    next();\n  });\n\n  if (database) {\n    connectDatabase(database);\n  }\n\n  app.use(\"/system\", expressHealth());\n\n  if (!routes) {\n    routes = express.Router();\n    const root = stack()\n      .find((site) => site.getFileName().endsWith(\"server.js\"))\n      ?.getFileName()\n      ?.replace(\"/server.js\", \"\")\n      ?.replace(\"\\\\server.js\", \"\");\n    fs.readdirSync(`${root}/modules`)?.forEach((module) => {\n      fs.readdirSync(`${root}/modules/${module}/api`)?.forEach((v) => {\n        routes.use(\n          `/${v}/${module}`,\n          require(`${root}/modules/${module}/api/${v}/controller`).default\n        );\n      });\n    });\n  }\n\n  app.use(`/api`, ...lMiddleware, routes);\n\n  app.use(responseInterceptor);\n\n  app.use(errorHandler);\n\n  const HOST = config.HOST ?? \"0.0.0.0\";\n\n  app.listen(config.PORT, () => {\n    logger.info(`${service} listening on ${HOST}:${config.PORT}`);\n  });\n};\n\nexport default initialize;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAAe;AACf,oBAAmB;AACnB,qBAAoB;AACpB,uCAA0B;AAC1B,yBAAwB;AACxB,oBAAmB;AACnB,kBAAiB;AACjB,kCAAoB;AACpB,sBAAkB;AAClB,2BAA6B;AAC7B,uBAA8B;AAC9B,wBAAkD;AAClD,sBAA2C;AAE3C,MAAM,aAAa,wBAAC;AAAA,EAClB;AAAA,EACA;AAAA,EACA,cAAc,CAAC;AAAA,EACf,MAAM;AAAA,EACN;AAAA,EACA;AACF,MAAM;AArBN;AAsBE,QAAM,aAAS,mCAAa,QAAQ;AAEpC,QAAM,UAAM,eAAAA,SAAQ;AAEpB,MAAI,QAAI,cAAAC,SAAO,CAAC;AAChB,MAAI,QAAI,mBAAAC,SAAY,CAAC;AAErB,MAAI,IAAI,eAAAF,QAAQ,KAAK,EAAE,OAAO,MAAM,CAAC,CAAC;AACtC,MAAI,IAAI,eAAAA,QAAQ,WAAW,EAAE,UAAU,KAAK,CAAC,CAAC;AAE9C,MAAI,cAAc;AAChB,QAAI,QAAI,YAAAG,SAAK,CAAC;AAAA,EAChB;AAEA,MAAI,IAAI,4BAAAC,QAAQ,UAAU;AAE1B,MAAI,IAAI,CAAC,KAAK,MAAM,SAAS;AAC3B,SAAK,OAAO,+BAA+B,GAAG;AAC9C,SAAK;AAAA,MACH;AAAA,MACA;AAAA,IACF;AACA,gCAAAA,QAAQ;AAAA,MACN;AAAA,MACA,IAAI,QAAQ,8BAAa,KAAK,cAAAC,QAAO,YAAY,EAAE,EAAE,SAAS,KAAK;AAAA,IACrE;AACA,SAAK;AAAA,EACP,CAAC;AAED,MAAI,UAAU;AACZ,wBAAAC,SAAgB,QAAQ;AAAA,EAC1B;AAEA,MAAI,IAAI,eAAW,iCAAAC,SAAc,CAAC;AAElC,MAAI,CAAC,QAAQ;AACX,aAAS,eAAAP,QAAQ,OAAO;AACxB,UAAM,QAAO,qCAAAQ,SAAM,EAChB,KAAK,CAAC,SAAS,KAAK,YAAY,EAAE,SAAS,WAAW,CAAC,MAD7C,mBAET,kBAFS,mBAGT,QAAQ,cAAc,QAHb,mBAIT,QAAQ,eAAe;AAC3B,oBAAAC,QAAG,YAAY,GAAG,cAAc,MAAhC,mBAAmC,QAAQ,CAACC,YAAW;AAhE3D,UAAAC;AAiEM,OAAAA,MAAA,UAAAF,QAAG,YAAY,GAAG,gBAAgBC,aAAY,MAA9C,gBAAAC,IAAiD,QAAQ,CAAC,MAAM;AAC9D,eAAO;AAAA,UACL,IAAI,KAAKD;AAAA,UACT,QAAQ,GAAG,gBAAgBA,eAAc,cAAc,EAAE;AAAA,QAC3D;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEA,MAAI,IAAI,QAAQ,GAAG,aAAa,MAAM;AAEtC,MAAI,IAAI,qCAAmB;AAE3B,MAAI,IAAI,8BAAY;AAEpB,QAAM,OAAO,OAAO,QAAQ;AAE5B,MAAI,OAAO,OAAO,MAAM,MAAM;AAC5B,WAAO,KAAK,GAAG,wBAAwB,QAAQ,OAAO,MAAM;AAAA,EAC9D,CAAC;AACH,GAvEmB;AAyEnB,IAAO,cAAQ;",
  "names": ["express", "helmet", "compression", "cors", "context", "crypto", "connectDatabase", "expressHealth", "stack", "fs", "module", "_a"]
}
