{
  "version": 3,
  "sources": ["../../src/middleware/auth.js"],
  "sourcesContent": ["/* eslint-disable import/named */\r\n\r\nimport { tracedAsyncHandler } from \"@sliit-foss/functions\";\r\nimport { protectedRoutes } from \"@app/constants\";\r\nimport { getUserById } from \"../services\";\r\nimport { verify, errors } from \"../utils\";\r\n\r\nexport const authorizer = tracedAsyncHandler(async function authorizer(req) {\r\n  if (protectedRoutes.find((route) => req.path.match(new RegExp(route)))) {\r\n    return;\r\n  }\r\n  const token = req.headers.authorization\r\n    ?.replace(\"Bearer \", \"\")\r\n    ?.replace(\"null\", \"\");\r\n\r\n  if (!token) throw errors.missing_token;\r\n\r\n  const decodedUser = verify(token);\r\n  const user = await getUserById(decodedUser._id);\r\n\r\n  if (!user) throw errors.invalid_token;\r\n  if (!user.is_active) throw errors.user_deactivated;\r\n\r\n  req.user = user;\r\n  req.token = token;\r\n});\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,uBAAmC;AACnC,uBAAgC;AAChC,sBAA4B;AAC5B,mBAA+B;AAExB,MAAM,iBAAa,qCAAmB,sCAAeA,YAAW,KAAK;AAP5E;AAQE,MAAI,iCAAgB,KAAK,CAAC,UAAU,IAAI,KAAK,MAAM,IAAI,OAAO,KAAK,CAAC,CAAC,GAAG;AACtE;AAAA,EACF;AACA,QAAM,SAAQ,eAAI,QAAQ,kBAAZ,mBACV,QAAQ,WAAW,QADT,mBAEV,QAAQ,QAAQ;AAEpB,MAAI,CAAC;AAAO,UAAM,oBAAO;AAEzB,QAAM,kBAAc,qBAAO,KAAK;AAChC,QAAM,OAAO,UAAM,6BAAY,YAAY,GAAG;AAE9C,MAAI,CAAC;AAAM,UAAM,oBAAO;AACxB,MAAI,CAAC,KAAK;AAAW,UAAM,oBAAO;AAElC,MAAI,OAAO;AACX,MAAI,QAAQ;AACd,GAlB6C,aAkB5C;",
  "names": ["authorizer"]
}
