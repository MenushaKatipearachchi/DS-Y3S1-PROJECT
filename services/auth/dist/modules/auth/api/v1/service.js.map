{
  "version": 3,
  "sources": ["../../../../../src/modules/auth/api/v1/service.js"],
  "sourcesContent": ["/* eslint-disable import/named */\n\nimport crypto from \"crypto\";\nimport bcrypt from \"bcryptjs\";\nimport createError from \"http-errors\";\nimport { traced } from \"@sliit-foss/functions\";\nimport {\n  createUser,\n  getUserByEmail,\n  getUserById,\n  //  eslint-disable-next-line no-unused-vars\n  sendVerificationEmail,\n  verifyUser,\n} from \"../../../../services\";\nimport { errors, verify, generateTokens } from \"../../../../utils\";\nimport { constructVerificationEmailPayload } from \"./mappers\";\n\nexport const serviceLogin = async ({ email, password }) => {\n  const user = await getUserByEmail(email);\n  if (!user) throw errors.invalid_email;\n  if (!user.is_active) throw errors.user_deactivated;\n\n  const isMatch = await bcrypt.compare(password, user.password);\n\n  if (!isMatch) throw errors.invalid_password;\n  if (!user.is_verified) throw errors.unverified_user;\n\n  return traced(generateTokens)(user);\n};\n\nexport const serviceRegister = async ({ name, email, password, address }) => {\n  const user = await getUserByEmail(email);\n  if (user) {\n    throw createError(400, \"User already exists\");\n  }\n  const code = crypto.randomUUID();\n  sendVerificationEmail(constructVerificationEmailPayload(name, email, code));\n\n  return createUser({\n    name,\n    email,\n    password,\n    address,\n    verification_code: code,\n  });\n};\n\nexport const serviceRefreshToken = async (token) => {\n  const decodedRefreshToken = verify(token);\n  const decodedUser = verify(decodedRefreshToken.access_token, true);\n  const user = await getUserById(decodedUser._id);\n  if (!user) {\n    throw errors.invalid_token;\n  }\n  if (!user.is_active) {\n    throw errors.user_deactivated;\n  }\n  return traced(generateTokens)(user);\n};\n\nexport const serviceVerifyUser = async (code) => {\n  const result = await verifyUser(code);\n  if (!result.matchedCount) {\n    throw errors.invalid_code;\n  }\n  return;\n};\n\n//  eslint-disable-next-line no-unused-vars\nexport const serviceLogout = (token) => {};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,oBAAmB;AACnB,sBAAmB;AACnB,yBAAwB;AACxB,uBAAuB;AACvB,sBAOO;AACP,mBAA+C;AAC/C,qBAAkD;AAE3C,MAAM,eAAe,8BAAO,EAAE,OAAO,SAAS,MAAM;AACzD,QAAM,OAAO,UAAM,gCAAe,KAAK;AACvC,MAAI,CAAC;AAAM,UAAM,oBAAO;AACxB,MAAI,CAAC,KAAK;AAAW,UAAM,oBAAO;AAElC,QAAM,UAAU,MAAM,gBAAAA,QAAO,QAAQ,UAAU,KAAK,QAAQ;AAE5D,MAAI,CAAC;AAAS,UAAM,oBAAO;AAC3B,MAAI,CAAC,KAAK;AAAa,UAAM,oBAAO;AAEpC,aAAO,yBAAO,2BAAc,EAAE,IAAI;AACpC,GAX4B;AAarB,MAAM,kBAAkB,8BAAO,EAAE,MAAM,OAAO,UAAU,QAAQ,MAAM;AAC3E,QAAM,OAAO,UAAM,gCAAe,KAAK;AACvC,MAAI,MAAM;AACR,cAAM,mBAAAC,SAAY,KAAK,qBAAqB;AAAA,EAC9C;AACA,QAAM,OAAO,cAAAC,QAAO,WAAW;AAC/B,iDAAsB,kDAAkC,MAAM,OAAO,IAAI,CAAC;AAE1E,aAAO,4BAAW;AAAA,IAChB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,mBAAmB;AAAA,EACrB,CAAC;AACH,GAf+B;AAiBxB,MAAM,sBAAsB,8BAAO,UAAU;AAClD,QAAM,0BAAsB,qBAAO,KAAK;AACxC,QAAM,kBAAc,qBAAO,oBAAoB,cAAc,IAAI;AACjE,QAAM,OAAO,UAAM,6BAAY,YAAY,GAAG;AAC9C,MAAI,CAAC,MAAM;AACT,UAAM,oBAAO;AAAA,EACf;AACA,MAAI,CAAC,KAAK,WAAW;AACnB,UAAM,oBAAO;AAAA,EACf;AACA,aAAO,yBAAO,2BAAc,EAAE,IAAI;AACpC,GAXmC;AAa5B,MAAM,oBAAoB,8BAAO,SAAS;AAC/C,QAAM,SAAS,UAAM,4BAAW,IAAI;AACpC,MAAI,CAAC,OAAO,cAAc;AACxB,UAAM,oBAAO;AAAA,EACf;AACA;AACF,GANiC;AAS1B,MAAM,gBAAgB,wBAAC,UAAU;AAAC,GAAZ;",
  "names": ["bcrypt", "createError", "crypto"]
}
