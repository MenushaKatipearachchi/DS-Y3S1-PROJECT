{
  "version": 3,
  "sources": ["../../../../../src/modules/payments/api/v1/controller.js"],
  "sourcesContent": ["import express from \"express\";\r\nimport mongoose from \"mongoose\";\r\nimport { celebrate, Segments } from \"celebrate\";\r\nimport { default as filterQuery } from \"@sliit-foss/mongoose-filter-query\";\r\nimport { asyncHandler } from \"@sliit-foss/functions\";\r\nimport { objectIdSchema } from \"@app/constants\";\r\nimport { toSuccess } from \"@app/middleware\";\r\nimport {\r\n  serviceCreatePayment,\r\n  serviceGetPayments,\r\n  serviceGetPaymentById,\r\n  serviceUpdatePaymentById,\r\n  serviceDeletePaymentById,\r\n} from \"./service\";\r\n\r\nimport { createPaymentSchema, updatePaymentSchema } from \"./schema\";\r\n\r\nconst app = express(); // Initialize the Express app\r\napp.set(\"view engine\", \"ejs\"); // Set the view engine to EJS\r\n\r\nconst payment = express.Router();\r\nconst paypal = require(\"paypal-rest-sdk\");\r\n\r\npaypal.configure({\r\n  mode: \"sandbox\", // sandbox or live\r\n  client_id:\r\n    \"AcmQTWo29gmRgHYMgbXjATiVnXHi-BgrpMIPvy7hEvHgHsQIa4jmgKj4geiMhgLLH2nV4Ns5Y0_f_nv1\",\r\n  client_secret:\r\n    \"EPbPDqR49DSsW59ES8ggYq9rWn-TbPeTPVaaLmz2o4nZONXi8qLRweFKEYcZIprMylkNyjaHQRghZi4G\",\r\n});\r\n\r\napp.post(\"/pay\", (req, res) => {\r\n  const create_payment_json = {\r\n    intent: \"sale\",\r\n    payer: {\r\n      payment_method: \"paypal\",\r\n    },\r\n    redirect_urls: {\r\n      return_url: \"http://localhost:4003/api/v1/payments/success\",\r\n      cancel_url: \"http://localhost:4003/api/v1/payments/cancel\",\r\n    },\r\n    transactions: [\r\n      {\r\n        item_list: {\r\n          items: [\r\n            {\r\n              name: \"Red Sox Hat\",\r\n              sku: \"001\",\r\n              price: \"25.00\",\r\n              currency: \"USD\",\r\n              quantity: 1,\r\n            },\r\n          ],\r\n        },\r\n        amount: {\r\n          currency: \"USD\",\r\n          total: \"25.00\",\r\n        },\r\n        description: \"Hat for the best team ever\",\r\n      },\r\n    ],\r\n  };\r\n\r\n  paypal.payment.create(create_payment_json, function (error, payment) {\r\n    if (error) {\r\n      throw error;\r\n    } else {\r\n      for (let index = 0; index < payment.links.length; index++) {\r\n        if (payment.links[index].rel === \"approval_url\") {\r\n          res.redirect(payment.links[index].href);\r\n        }\r\n      }\r\n    }\r\n  });\r\n});\r\n\r\npayment.post(\r\n  \"/\",\r\n  celebrate({ [Segments.BODY]: createPaymentSchema }),\r\n  asyncHandler(async function controllerCreatePayment(req, res) {\r\n    const data = await serviceCreatePayment({\r\n      ...req.body,\r\n      user_id: mongoose.Types.ObjectId(req.body.user_id), // convert user_id to ObjectId\r\n    });\r\n    return toSuccess({ res, data, message: \"Payment created successfully!\" });\r\n  })\r\n);\r\n\r\napp.get(\"/paypal\", (req, res) => res.render(\"index\"));\r\n\r\napp.get(\"/success\", (req, res) => {\r\n  const payerID = req.query.PayerID;\r\n  const paymentId = req.query.paymentId;\r\n\r\n  const execute_payment_json = {\r\n    payer_id: payerID,\r\n    transactions: [\r\n      {\r\n        amount: {\r\n          currency: \"USD\",\r\n          total: \"25.00\",\r\n        },\r\n      },\r\n    ],\r\n  };\r\n\r\n  paypal.payment.execute(\r\n    paymentId,\r\n    execute_payment_json,\r\n    function (error, payment) {\r\n      if (error) {\r\n        console.log(error.response);\r\n        throw error;\r\n      } else {\r\n        console.log(JSON.stringify(payment));\r\n        res.send(\"Success\");\r\n      }\r\n    }\r\n  );\r\n});\r\n\r\napp.get(\"/cancel\", (req, res) => res.send(\"Cancelled\"));\r\n\r\npayment.get(\r\n  \"/\",\r\n  filterQuery,\r\n  asyncHandler(async function controllerGetPayments(req, res) {\r\n    const data = await serviceGetPayments(\r\n      req.query.filter,\r\n      req.query.sort,\r\n      req.query.page,\r\n      req.query.limit\r\n    );\r\n    return toSuccess({ res, data, message: \"Payments fetched successfully!\" });\r\n  })\r\n);\r\n\r\npayment.get(\r\n  \"/:id\",\r\n  celebrate({ [Segments.PARAMS]: objectIdSchema() }),\r\n  asyncHandler(async function controllerGetPaymentById(req, res) {\r\n    const data = await serviceGetPaymentById(req.params.id);\r\n    return toSuccess({ res, data, message: \"Payment fetched successfully!\" });\r\n  })\r\n);\r\n\r\npayment.patch(\r\n  \"/:id\",\r\n  celebrate({\r\n    [Segments.PARAMS]: objectIdSchema(),\r\n    [Segments.BODY]: updatePaymentSchema,\r\n  }),\r\n  asyncHandler(async function controllerUpdatePaymentById(req, res) {\r\n    const data = await serviceUpdatePaymentById(req.params.id, req.body);\r\n    return toSuccess({ res, data, message: \"Payment updated successfully!\" });\r\n  })\r\n);\r\n\r\npayment.delete(\r\n  \"/:id\",\r\n  celebrate({ [Segments.PARAMS]: objectIdSchema() }),\r\n  asyncHandler(async function controllerDeletePaymentById(req, res) {\r\n    const data = await serviceDeletePaymentById(req.params.id);\r\n    return toSuccess({ res, data, message: \"Payment deleted successfully!\" });\r\n  })\r\n);\r\n\r\napp.use(payment); // Mount the payment router on the Express app\r\n\r\nexport default app;\r\n"],
  "mappings": "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",
  "names": ["express", "payment", "mongoose", "filterQuery"]
}
